<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>List of Books</title>
</head>
<body>
<h2>Books List</h2>
<table>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Action</th>
    </tr>
    <tr th:each="book : ${books}">
        <td th:text="${book.id}"></td>
        <td th:text="${book.title}"></td>
        <td>
            <a th:href="@{/reviews/{bookId}(bookId=${book.id})}">View Reviews</a>
        </td>
    </tr>
</table>


<!-- Review Submission Form -->
<!-- bellow the list view -->
<h3>Submit a Review</h3>
<form th:action="@{/reviews/{bookId}/add(bookId=${book.id})}" method="post" th:if="${!#lists.isEmpty(books)}">
    <label>Review:</label>
    <label>
        <textarea name="reviewText" required></textarea>
    </label>
    <input type="submit" value="Submit Review">
</form>

<!-- Back to home page -->
<a href="/">Back to Home</a>

<!-- Script to handle asynchronous loading -->
<script>
    function loadBookDetails(bookId) {
        fetch(`/reviews/${bookId}`)
            .then(response => response.text())
            .then(data => {
                document.getElementById('book-details').innerHTML = data;
            })
            .catch(error => console.error('Error loading book details:', error));
    }
</script>
</body>
</html>